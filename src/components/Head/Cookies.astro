---
import "vanilla-cookieconsent/dist/cookieconsent.css";
import "../../styles/cookies.css";
---

<script>
  import * as CookieConsent from "vanilla-cookieconsent";

  window.addEventListener("load", function () {
    CookieConsent.run({
      manageScriptTags: true,
      guiOptions: {
        consentModal: {
          layout: "cloud", // box/cloud/bar/popup
          position: "bottom right", // bottom/middle/top + left/right/center
          flipButtons: false, // previously swap_buttons
        },
        preferencesModal: {
          layout: "box", // box/bar
        },
      },

      // Categories must now be defined at the root level
      categories: {
        necessary: {
          readOnly: true,
          enabled: true,
        },
        analytics_cookies: {
          readOnly: false,
          enabled: false,
        },
      },

      onConsent: function ({ cookie }) {
        if (CookieConsent.acceptedCategory("analytics_cookies")) {
          loadAnalytics();
        }
      },

      onChange: function ({ changedCategories, cookie }) {
        if (
          changedCategories.includes("analytics_cookies") &&
          CookieConsent.acceptedCategory("analytics_cookies")
        ) {
          loadAnalytics();
        }
      },

      language: {
        default: "en",
        translations: {
          en: {
            consentModal: {
              title: "Cookies & Privacy Policy",
              description: `Enabling cookies allows you to use our website to its full extent and to personalize your experience on our sites. They tell us which parts of our websites people have visited, help us measure the effectiveness of ads and web searches and give us insights into user behavior so we can improve our communications with you. <a class="cc-link" aria-label="Cookies Policy-Privacy Policy" href="/cookies/">Cookies Policy-Privacy Policy</a>`,
              acceptAllBtn: "Accept all Cookies",
              showPreferencesBtn: "Customise Cookies",
            },
            preferencesModal: {
              title: "Cookie settings",
              savePreferencesBtn: "Save settings",
              acceptAllBtn: "Accept all",
              closeIconLabel: "Close", // Replaces standard X
              sections: [
                {
                  title: "Cookie usage",
                  description:
                    'We use cookies to ensure the basic functionalities of the website and to enhance your online experience. You can choose for each category to opt-in/out whenever you want. For more details about cookies and how we use them, read the full <a href="/cookies" class="cc-link">cookie policy</a>.',
                },
                {
                  title: "Analytics cookies",
                  description:
                    "These cookies collect information about how you use the website, which pages you visited and which links you clicked on. All of the data is anonymized and cannot be used to identify you.",
                  linkedCategory: "analytics_cookies", // Connects this section to the category above
                  cookieTable: {
                    headers: {
                      name: "Name",
                      domain: "Domain",
                      expiration: "Expiration",
                      description: "Description",
                      policy: "Privacy policy",
                    },
                    body: [
                      {
                        name: "_ga",
                        domain: "google.com",
                        expiration: "2 years",
                        description: "Permanent cookie used to distinguish users.",
                        policy:
                          '<a href="https://policies.google.com/privacy?hl=en-US" style="word-break: break-all;">Privacy Policy</a>',
                      },
                      {
                        name: "_gat",
                        domain: "google.com",
                        expiration: "1 minute",
                        description:
                          "Permanent Cookie used to throttle request rate. If Google Analytics is deployed via Google Tag Manager, this cookie will be named _dc_gtm_<property- id>.",
                        policy:
                          '<a href="https://policies.google.com/privacy?hl=en-US" style="word-break: break-all;">Privacy Policy</a>',
                      },
                      {
                        name: "_gid",
                        domain: "google.com",
                        expiration: "1 day",
                        description: "Permanent Cookie used to distinguish users.",
                        policy:
                          '<a href="https://policies.google.com/privacy?hl=en-US" style="word-break: break-all;">Privacy Policy</a>',
                      },
                    ],
                  },
                },
              ],
            },
          },
        },
      },
    });

    // Custom helper to replace the removed cc.loadScript method
    function loadAnalytics() {
      // Prevent multiple script tags from loading
      if (document.getElementById("ga-script")) return; 
      
      const script = document.createElement("script");
      script.id = "ga-script";
      script.src = "https://www.google-analytics.com/analytics.js";
      script.onload = function () {
        // @ts-ignore
        ga("create", "", "auto");
        // @ts-ignore
        ga("send", "pageview");
      };
      document.head.appendChild(script);
    }
  });
</script>